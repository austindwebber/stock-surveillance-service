<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>My Portfolio</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $("#dbpost").click(function(e) {
        e.preventDefault();
        var stock = $("#stockTicker").val();
        var userid = "tonypetersen@hotmail.com";
        $.ajax({
          type: "POST",
          url: 'https://9hhkhg6iw3.execute-api.us-east-1.amazonaws.com/v5/updateportfolio', contentType: 'application/json',
          data: JSON.stringify({
            'stock': stock,
            'userid': userid
          }),
          success: function(res){
            $('#form-response').html('<div class="alert alert-info" role="alert">Portfolio Updated!</div>');
          },
          error: function(){
            $('#form-response').html('<div class="alert alert-info" role="alert">Oops! Something went wrong ... </div>');
          }
        });
      })
    });
  </script>
  <script>
    function loadPortfolio() {
      var userid = "tonypetersen@hotmail.com";

      $.ajax({
        type: "POST",
        url: 'https://9hhkhg6iw3.execute-api.us-east-1.amazonaws.com/v5/portfolio', contentType: 'application/json',
        data: JSON.stringify({
          'userid': userid
        }),
        success: function(res){
          console.log(res);

          console.log(res.length);

          var e = document.body; // whatever you want to append the rows to:

          for(var i = 0; i < res.length; i++){

            var row = document.createElement("div");
            var buttonStock = document.createElement('input');
            var buttonRemove = document.createElement('input');

            buttonStock.setAttribute('type', 'button');
            buttonStock.setAttribute('value', 'More Info: ' + res[i]['symbol']);

            buttonRemove.setAttribute('type', 'button');
            buttonRemove.setAttribute('value', 'Remove');

            row.className = "companyWrapper";
            row.textContent = res[i]['companyName'] + "\r\n";
            row.textContent += res[i]['symbol'] + "\r\n";
            row.textContent += res[i]['price'] + "\r\n";
            row.textContent += res[i]['changes'] + "\r\n";

            e.appendChild(row);
            row.appendChild(buttonStock);
            row.appendChild(buttonRemove);
          }

          $('#form-response').html('<div class="alert alert-info" role="alert">Current Porfolio Overview</div>');
        },
        error: function(){
          $('#form-response').html('<div class="alert alert-info" role="alert">Oops! Something went wrong ... </div>');
        }
      });
    }
  </script>
  <script>
    window.addEventListener('load', function () {
        loadPortfolio();
    });
  </script>
  <link rel="icon" type="image/ico" href="logo/favicon.ico">
  <link rel="stylesheet" href="css/portfolio.css">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville&display=swap" rel="stylesheet">
</head>
<body>
  <div id="upper" class="bodyWrapper">
    <img src="logo/surveillance_logo_with_name.PNG" alt="Stock Surveillance">

    <br><p><h1>Portfolio View</h1></p>

  </div>
  <input type="text" id="stockTicker" class="form-control" placeholder="Ticker" required />
  <button class="btn btn-lg btn-primary btn-block" id="dbpost" type="submit" style="background-color:#FCFAF9;">DB Update</button>
  <p><span id="form-response"></span></p>
</body>
</html>
